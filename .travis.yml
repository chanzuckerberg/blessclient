dist: bionic
language: go
go_import_path: github.com/chanzuckerberg/blessclient
sudo: false
go:
  - "1.14"
env:
  - CGO_ENABLED=0
stages:
  - test
  - publish-osx
  - publish-prerelease-osx
  - publish-linux
matrix:
  include:
    - os: linux
      stage: test
      install:
        - sudo apt update -q
      script:
        - make test-ci
        - bash <(curl -s https://codecov.io/bash)
    - os: osx
      stage: test
      script:
        - make test-ci
    - os: linux
      stage: test
      install:
        - sudo apt update -q
        - npm install -g snyk
      script:
        - snyk monitor --org=czi
        - snyk test || echo "Skipping Failed Test"
    - os: linux
      stage: test
      sudo: true
      install:
        - make setup
        - sudo apt update -q
      script:
        - make lint-ci
